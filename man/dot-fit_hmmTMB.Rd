% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/classify_hmm_utils.R
\name{.fit_hmmTMB}
\alias{.fit_hmmTMB}
\title{INTERNAL Fit Hidden Markov Model using hmmTMB}
\usage{
.fit_hmmTMB(
  data,
  features,
  n_states,
  feature_distributions,
  initial_params = NULL,
  id_var = NULL
)
}
\arguments{
\item{data}{Data frame containing feature columns and optional ID column}

\item{features}{Character vector of feature column names}

\item{n_states}{Integer. Number of hidden states}

\item{feature_distributions}{Named list of distribution specifications from
\code{.auto_select_distribution}}

\item{initial_params}{Optional list of initial parameter values. If NULL,
uses GMM-based initialization or quantile-based defaults}

\item{id_var}{Character. Column name for temporal breaks. If provided, the
column will be duplicated as 'ID' for hmmTMB integration}
}
\value{
Fitted hmmTMB model object, or NULL if fitting fails
}
\description{
Core HMM fitting function that creates and fits an hmmTMB model. Handles
distribution specification, parameter initialization (via GMM or
quantile-based defaults), and model fitting with multiple optimizer
fallbacks.
}
\details{
Fitting procedure:
\enumerate{
\item Maps distribution names to hmmTMB format
\item Initializes parameters via GMM (\code{.estimate_initial_params_gmm})
\item Falls back to quantile-based initialization if GMM fails
\item Creates hmmTMB Observation and MarkovChain objects
\item Attempts fitting with default optimizer
\item Falls back to BFGS optimizer if default fails
\item Returns NULL with informative error messages if all attempts fail
}

Handles special cases:
\itemize{
\item Ensures positive values for gamma distributions
\item Caps von Mises kappa to prevent overflow
\item Constrains beta parameters for numerical stability
}
}
\keyword{internal}
